<project name="envUtil" default="run">
	<property name="lib.dir" value="lib" />
	<property name="test.dir" value="test" />
	<property name="log4j" value="log4j-1.2.15.jar" />
	<property name="junit" value="junit.jar" />
	<property name="sig" value="sigar.jar" />
	<property name="sigamd64dll" value="sigar-amd64-winnt.dll" />
	<property name="sigx86dll" value="sigar-x86-winnt.dll" />

	<path id="classpath.base">
		<pathelement location="${lib.dir}/${sig}" />
		<pathelement location="${lib.dir}/${sigamd64dll}" />
		<pathelement location="${lib.dir}/${sigx86dll}" />
		<pathelement location="${lib.dir}/${log4j}" />
	</path>
	<path id="classpath.test">
		<pathelement location="${lib.dir}/${junit}" />
		<pathelement location="${test.dir}" />
		<path refid="classpath.base" />
	</path>

	<target name="clean">
		<delete dir="bin" />
	</target>

	<target name="compile">
		<mkdir dir="bin/classes" />
		<javac srcdir="src" destdir="bin/classes" classpathref="classpath.base" />
	</target>

	<target name="compile-test">
		<mkdir dir="bin/classes" />
		<javac srcdir="src" destdir="bin/classes" classpathref="classpath.base" />
		<javac srcdir="test" destdir="bin/classes" classpathref="classpath.test" />
	</target>

	<target name="jar" depends="compile">
		<mkdir dir="bin/jar" />
		<jar destfile="bin/jar/envUtil.jar" basedir="bin/classes">
			<manifest>
				<attribute name="Main-Class" value="com.stabilit.environment.log.EnvLogFile" />
			</manifest>
		</jar>
	</target>

	<target name="run" depends="jar">
		<mkdir dir="log" />
		<java classname="com.stabilit.environment.log.EnvLog" fork="true">
			<arg value="C:\\stabilit\\projects\\EUREX\\SC\\dev\\eclipse_workspace\\envUtil\\log\\envLog.txt" />
			<classpath>
				<path refid="classpath.base" />
				<path location="bin/jar/envUtil.jar" />
			</classpath>
		</java>
		<antcall target="junit" />
	</target>

	<target name="junit" depends="compile-test, jar">
		<mkdir dir="log" />
		<junit printsummary="yes">
			<classpath>
				<path refid="classpath.test" />
				<path location="bin/jar/envUtil.jar" />
			</classpath>

			<batchtest fork="yes">
				<fileset dir="${test.dir}" includes="**/*Test.java" />
			</batchtest>
		</junit>
	</target>
</project>
